function init_itineraire(e,t){end=new google.maps.LatLng(e,t);getLocation()}function getLocation(){$.msgBox({title:"Chargement...",content:"Chargement de l'itineraire...",type:"info",opacity:.9,showButtons:false,autoClose:true});if(navigator.geolocation){navigator.geolocation.getCurrentPosition(showPosition,showError)}else{x.innerHTML="La géolocalisation n'est pas supporté par le navigateur."}}function showPosition(e){address=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);initialize()}function showError(e){switch(e.code){case e.PERMISSION_DENIED:x.innerHTML="Géolocalisation non authorisée.";break;case e.POSITION_UNAVAILABLE:x.innerHTML="Localisation non disponible.";break;case e.TIMEOUT:x.innerHTML="Echec de la localisation.";break;case e.UNKNOWN_ERROR:x.innerHTML="Erreur inconnue.";break}}function initialize(){var e=new google.maps.DirectionsRenderer,t=new google.maps.DirectionsService,n={origin:address,destination:end,region:"fr",travelMode:google.maps.DirectionsTravelMode.DRIVING};mapOptions={zoom:7,mapTypeId:google.maps.MapTypeId.ROADMAP,center:address,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,position:google.maps.ControlPosition.TOP_LEFT}};map=new google.maps.Map(document.getElementById("restaurantMapHolder"),mapOptions);e.setMap(map);e.setPanel(document.getElementById("restaurantAddressText"));t.route(n,function(t,n){if(n==google.maps.DirectionsStatus.OK){e.setDirections(t)}});distance=google.maps.geometry.spherical.computeDistanceBetween(address,end)}function initMenuAlpha(){$.ajax({url:"http://udamobile.u-clermont1.fr/v2/restaurant/",type:"GET",cache:true,success:function(e){makeList(e)}})}function makeList(e){var t="";jsonResto=jQuery.isPlainObject(e)?e:jQuery.parseJSON(e);if(jsonResto.code_retour=="ok"){nbelt=jsonResto.count;if(nbelt>0){for(i=0;i<nbelt;i++){t+='<li class="ui-btn ui-btn-up-a ui-btn-icon-right ui-li-has-arrow ui-li ui-first-child"'+"onclick=\"makeFicheMenu('"+escape(jsonResto[i].nom)+"','"+escape(jsonResto[i].adresse)+"','"+jsonResto[i].code_postal+"','"+jsonResto[i].description+"','"+jsonResto[i].latitude+"','"+jsonResto[i].longitude+"');menu("+i+')">'+'<div class="ui-btn-inner ui-li"><div class="ui-btn-text"><a href="#menuPage" class="ui-link-inherit" data-transition="slide">'+'<img src="http://udamobile.u-clermont1.fr/v2/restaurant/img/'+jsonResto[i].id+'.jpg"/>'+jsonResto[i].nom+"("+jsonResto[i].etat+")"+'</a></div><span class="ui-icon ui-icon-arrow-r ui-icon-shadow"></span></div></li>'}$("#listeRestaurant").html(t)}else{t+="<li>Pas de service.</li>"}}else{t+="<li>Service temporairement indisponible</li>"}}function makeFicheMenu(e,t,n,r,i,s){setdate();makeaddress(e,t,n,r,i,s);init_itineraire(i,s)}function setdate(){month=today.getMonth();TabJour=new Array("Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi");TabMois=new Array("janvier","février","mars","avril","mai","juin","juillet","aout","septembre","octobre","novembre","décembre");messageDate=TabJour[jour]+" "+numero+" "+TabMois[month];$("#pdate").html(messageDate);month=month+1;if(month>9){day=today.getFullYear()+"-"+month+"-"+numero}else{day=today.getFullYear()+"-0"+month+"-"+numero}}function makeaddress(e,t,n,r,i,s){nomRestaurant=unescape(e);lat=i;lon=s;$("#restaurantAddress").html("<h4>Adresse : "+unescape(t)+", "+n+", "+r+"</h4>")}function menu(e){m=e;$.ajax({url:"http://udamobile.u-clermont1.fr/v2/restaurant/?menu="+m+"&token=2a2a504c2d&date="+day,type:"GET",cache:true,success:function(e){makemenu(e)}})}function makemenu(e){var t="",n,r,i,s,o;$("#Rname").html('<h3 style="background: url(images/blackboard.jpg) no-repeat center center !important;">'+nomRestaurant+"</h3>");if(e!=""){n=jQuery.isPlainObject(e)?e:jQuery.parseJSON(e);r=jQuery.isPlainObject(n)?e:jQuery.parseJSON(n);i=Object.keys(n.midi).length;s=Object.keys(n.soir).length;o=n.date;if(day==o){if(i>0){t+='<li><img src="images/applications_science.png" class="icons"></img><p>Midi : </p></li>'+'<li id="EntréesM"><img src="images/toast.png" class="icons"></img><p>Entrées : '+n.midi.Entrées+"</p></li>"+'<li id="PlatsM"><img src="images/space_food.png" class="icons"></img><p>Plats : '+n.midi.Plats+"</p></li>"+'<li id="LégumesM"><img src="images/pepper.png" class="icons"></img><p>Légumes : '+n.midi.Légumes+"</p></li>"+'<li id="DessertsM"><img src="images/strawberry_ice_cream.png" class="icons"></img><p>Desserts : '+n.midi.Desserts+"</p></li>"}else{t+='<li><span class="underline">Midi</span> : Aucun service.</li>'}if(s>0){t+='<li><img src="images/weather_few_clouds_night.png" class="icons"></img><p>Soir : </p></li>'+'<li id="EntréesSoir"><img src="images/toast.png" class="icons"></img><p>Entrées : '+n.soir.Entrées+"</p></li>"+'<li id="Plats"><img src="images/space_food.png" class="icons"></img><p>Plats : '+n.soir.Plats+"</p></li>"+'<li id="Légumes"><img src="images/pepper.png" class="icons"></img><p>Légumes : '+n.soir.Légumes+"</p></li>"+'<li id="Desserts"><img src="images/strawberry_ice_cream.png" class="icons"></img><p>Desserts : '+n.soir.Desserts+"</p></li>"}else{t+='<li><span class="underline">Soir</span> : Aucun service.</li>'}}else{t+='<li class="noneResultMenu">Le menu n\'a pas été envoyé.</li>'}}else{t+='<li class="noneResultMenu">Le menu n\'a pas été envoyé.</li>'}$("#listMenu").html(t)}var nbelt,i,m,jsonResto,lat,lon,mapOptions,map,address,end,nomRestaurant,jour,month,day=new Array,today=new Date,numero=today.getDate();$(document).on("click","#btnBack",function(){$("#restaurantAddressText").html("");jour=today.getDay();numero=today.getDate()});$(document).on("swipeleft","#btnNext",function(){numero=numero+1;jour=jour+1;if(jour>5){alert("Aucun accés au menu les week-end.");jour=1;numero=numero+2}setdate();menu(m)});$(document).on("swiperight","#btnLast",function(){numero=numero-1;jour=jour-1;if(jour<1){alert("Aucun accés au menu les week-end.");numero=numero-2;jour=5}setdate();menu(m)});$(document).ready(function(){initMenuAlpha();jour=today.getDay();numero=today.getDate();setdate()})